1. docker network inspect my-large-scale-system_default
   1. 查看 container 的網路資料
2. 避免每次都將 images 刪除，重新 docker compose up -d
   1. docker-compose up --build
      1. 全服務重新 build
   2. docker compose build <服務名稱>


docker network
* 为什么要使用 Docker 网络？
  * 目前所有组件都在云主机上运行，并使用主机网络。
  * 组件之间通过主机名进行通信 (例如，web 应用调用授权服务时使用 localhost)。
  * 这并不是真实系统的配置，实际系统使用的是真实主机或虚拟机，拥有各自的主机名。
* 解决方案：
  * 创建一个名为 "docker-network" 的 Docker 桥接网络。
  * 将所有容器加入到该网络中。
  * 组件之间可以使用各自的容器名进行通信，而无需再使用 localhost。
* 为什么要使用 Docker 卷？
  * 容器中的数据会保存在容器内部的文件系统中
  * 停止或删除容器后，这些数据也会丢失，因为容器是短暂的。
* 解决方案：
  * 在主机上创建 Docker 卷。
  * 将容器中需要持久保存数据的目录挂载到 Docker 卷。
  * 这样，数据就保存在主机上，由 Docker 进行管理，即使容器被删除，数据也不会丢失。


* 當更改 docker compose.yml，需要刪除 container ，也需要刪除 images ，才可以套用到新的設定
  * docker-compose down
  * docker-compose rm -f
  * 如果是更改網路設定，可以用 restart
    * docker-compose restart <container_name>

* gateway
  *  本文讨论了微服务架构中路由问题的解决方案，重点介绍了使用 Netflix Zuul 网关服务进行服务路由管理。
  *  1. 问题：微服务架构中，客户端（例如单页应用、移动应用）需要知道服务的位置（主机、端口）才能发起请求。
  *  这种方式使得客户端配置复杂，且服务配置变更时需要更新所有客户端。
  *  2. 解决方案：网关服务
  *  引入网关服务作为中间层，所有请求都先经过网关服务。
  *  网关服务根据 URL 等信息将请求路由到相应的微服务。
  *  客户端只需要知道网关服务的地址，无需关心后端微服务的具体位置。
  *  3. 实现方式：
  *  可以使用反向代理 (例如 Nginx) 实现网关服务的功能，但功能有限。
  *  推荐使用 Netflix Zuul 网关服务：
  *  与 Spring Cloud 框架兼容，便于集成。
  *  提供丰富的功能，例如:
  *  集中式认证
  *  请求/响应日志记录
* "logs"（日誌）、"trace"（追蹤）、和 "metrics"（指標或性能指標） 是三個常見的術語，它們用於監控和管理應用程式的不同方面。以下是對這些術語的簡單解釋：
* 		Logs（日誌）：
    * 日誌是應用程式或系統在運行時生成的詳細記錄。這些記錄通常包含有關應用程式的事件、錯誤、警告和其他重要信息的記錄。
    * 日誌對於故障排除、調試和了解應用程式運行狀態非常重要。它們可以提供對應用程式內部運作的洞察，有助於識別問題和追蹤應用程式的行為。
    * 日志收集:
      * 在每個生成日誌的機器上部署日志代理 (agent)。代理實時讀取日誌並將其發送到日志收集器 (log collector)。日志处理和存储:日誌收集器接收來自各個代理的日誌。收集器處理日誌，使其具有可分析的結構。將處理后的日誌永久存儲到可靠的存儲系統中。日志分析:分析组件讀取存儲的日誌信息。分析组件可以生成報告和其他形式的分析結果。
    * 日志收集:
      * 選擇 Fluentd 作為日志代理，將各個機器上的日誌傳輸到日志收集器。對於 Docker 容器化的組件，可以使用 Fluentd 的 Docker 驅動程序，無需額外安裝代理。日志存储:選擇 Elasticsearch 作為日志存儲，因為它適合高吞吐量數據存儲和检索，且與 Fluentd 集成良好。日志分析:選擇 Kibana 作為日志分析工具，因为它易於使用，可以提供可视化的界面和报告。
* 		Trace（追蹤）：
    * 追蹤是用於追蹤應用程式中不同組件之間的操作流程的工具。它允許開發者了解一個請求或事務如何在系統中傳播，並且可以標示各個組件的性能。
    * 追蹤可以用來識別性能瓶頸、優化代碼以及理解複雜的系統互動。分佈式系統中的追蹤對於解決跨越多個服務的性能問題尤為重要。
    * 查看延遲時間
    * * 能问题定位： 在大规模系统中，可能存在多个服务和组件相互协作来处理一个请求。当性能问题发生时，追踪系统可以帮助确定导致问题的具体组件或服务。这对于快速定位和解决性能瓶颈至关重要。
      * 		分布式系统复杂性： 分布式系统通常由多个服务和组件构成，它们可能分布在不同的服务器、容器或云中。追踪请求能够揭示整个系统中的调用链，帮助理解请求的流经路径，从而更好地理解系统的复杂性。
  * 服务间通信： 在分布式系统中，不同的服务通过网络进行通信。追踪可以帮助监测和度量服务之间的通信性能，识别潜在的延迟或故障，有助于保持服务之间的协调和稳定性。
      * 用户体验： 对于端用户而言，追踪可以提供对其请求的可见性。通过了解请求在整个系统中的执行路径，可以更好地了解用户体验，发现和解决可能影响用户满意度的问题。
    * 容量规划： 通过分析请求追踪数据，可以获得对系统资源使用情况的洞察。这有助于进行容量规划，确保系统能够处理未来的负载，并预测何时需要扩展或优化特定组件。
    * 如果某个API开始表现不佳，那么我们怎么知道在这个系统中哪个组件负责这种性能不佳呢？这就是分布式请求跟踪出现的地方。它帮助我们准确定位性能不佳的确切原因，我们能够找出是哪个组件导致了延迟，以及导致了多少延迟。因此，在这里我们进行的是对整个系统进行概要和监视。我们知道有各种各样监视和概要单个组件的方法。但在这里问题不同。问题在于我们希望对整个系统进行概要。如果一个请求穿过整个系统经过其许多组件，那么到底哪个组件减慢了请求？这就是我们需要找出的。因此，需要做的是我们需要连接每个组件产生的概要信息，并且我们必须有意义地连接它，以便我们确切地知道在哪个API中，哪个组件导致了性能问题。这就是分布式请求追踪，它对于大规模分布式系统是绝对必要的。让我们了解在我们的系统中实施分布式请求追踪需要什么样的体系结构，然后我们将继续实际实施它。
    * 在 distributed tracing 中 span 是什麼意思
    * 在分布式追踪（Distributed Tracing）中，"span" 是指分布式系统中的一小段操作或工作单元。它代表一个跨足服务或组件的工作单元，可以包含对其他服务的调用、处理请求的时间、执行某些计算的时间等等。Span 被用来构建请求的完整追踪路径，帮助分析和理解分布式系统的性能和行为。每个 Span 都有一个唯一的标识符，它通常包括一个操作的名称、开始时间和结束时间。Span 之间还可以存在父子关系，构成一颗追踪树，以展示分布式系统中服务间相互调用的路径。
    * 在一个典型的分布式追踪系统中，Span 包含以下信息：
    * Trace ID（追踪标识）： 标识整个追踪的唯一标识符。
    * Span ID（Span 标识）： 标识单个 Span 的唯一标识符。
    * Parent Span ID（父 Span 标识）： 如果存在父子 Span 关系，标识父 Span 的唯一标识符。
    * 操作名称： 描述 Span 所执行的操作的名称。
    * 开始时间和结束时间： 记录 Span 的开始和结束时间。
    * 标签（Tags）： 用于附加额外的元数据，例如请求参数、响应状态等。
    * 日志（Logs）： 记录与 Span 相关的事件或日志信息。
    * 追蹤每一筆資料是不實際的
    * 所以可以設定一個百分比，抽樣調查
* 		Metrics（指標）：
    * 指標是用於量化和衡量應用程式或系統性能的數據。這些數據可以包括各種方面，例如請求速率、錯誤率、CPU使用率等。
    * 指標通常用於監控應用程式的運行狀態，以及評估性能和健康狀態。它們提供了對系統行為的定量洞察，有助於預測和防止問題。
    * 吞吐量 throughput


